from pylab import *
import postgkyl as pg
style.use('postgkyl.mplstyle')

def calcSubCellFit_p1(fL, fI, fR):
    x = linspace(-1, 1, 20)
    dx = 2.0
    return (23.57633877428808*fR[1]*x**5)/dx**5+(23.57633877428808*fL[1]*x**5)/dx**5+(81.44553394754065*fI[1]*x**5)/dx**5-(18.56155300614687*fR[0]*x**5)/dx**5+(18.56155300614687*fL[0]*x**5)/dx**5+(2.296396633859228*fR[1]*x**4)/dx**4-(2.296396633859228*fL[1]*x**4)/dx**4-(1.325825214724776*fR[0]*x**4)/dx**4-(1.325825214724776*fL[0]*x**4)/dx**4+(2.651650429449552*fI[0]*x**4)/dx**4-(12.5026038954558*fR[1]*x**3)/dx**3-(12.5026038954558*fL[1]*x**3)/dx**3-(45.41762231410475*fI[1]*x**3)/dx**3+(10.16465997955662*fR[0]*x**3)/dx**3-(10.16465997955662*fL[0]*x**3)/dx**3-(1.913663861549357*fR[1]*x**2)/dx**2+(1.913663861549357*fL[1]*x**2)/dx**2+(1.458407736197253*fR[0]*x**2)/dx**2+(1.458407736197253*fL[0]*x**2)/dx**2-(2.916815472394507*fI[0]*x**2)/dx**2+(1.243881510007081*fR[1]*x)/dx+(1.243881510007081*fL[1]*x)/dx+(7.08055628773262*fI[1]*x)/dx-(1.027514541411701*fR[0]*x)/dx+(1.027514541411701*fL[0]*x)/dx+0.130767030539206*fR[1]-0.130767030539206*fL[1]-0.104961162832378*fR[0]-0.104961162832378*fL[0]+0.917029106851303*fI[0] 

def calcSubCellFit_p2(fL, fI, fR):
    x = linspace(-1, 1, 20)
    dx = 2.0
    return (-(105.4224314958633*fR[2]*x**6)/dx**6)-(105.4224314958633*fL[2]*x**6)/dx**6+(559.4859750252903*fI[2]*x**6)/dx**6+(138.2430773583255*fR[1]*x**6)/dx**6-(138.2430773583255*fL[1]*x**6)/dx**6-(92.80776503073433*fR[0]*x**6)/dx**6-(92.80776503073433*fL[0]*x**6)/dx**6+(185.6155300614687*fI[0]*x**6)/dx**6-(15.77185983008978*fR[2]*x**5)/dx**5+(15.77185983008978*fL[2]*x**5)/dx**5+(18.21807996194988*fR[1]*x**5)/dx**5+(18.21807996194988*fL[1]*x**5)/dx**5+(40.72276697377032*fI[1]*x**5)/dx**5-(11.13693180368812*fR[0]*x**5)/dx**5+(11.13693180368812*fL[0]*x**5)/dx**5+(56.03160729110844*fR[2]*x**4)/dx**4+(56.03160729110844*fL[2]*x**4)/dx**4-(319.5876860307667*fI[2]*x**4)/dx**4-(75.0156233727348*fR[1]*x**4)/dx**4+(75.0156233727348*fL[1]*x**4)/dx**4+(51.04427076690387*fR[0]*x**4)/dx**4+(51.04427076690387*fL[0]*x**4)/dx**4-(102.0885415338078*fI[0]*x**4)/dx**4+(9.091548272984086*fR[2]*x**3)/dx**3-(9.091548272984086*fL[2]*x**3)/dx**3-(11.48198316929614*fR[1]*x**3)/dx**3-(11.48198316929614*fL[1]*x**3)/dx**3-(29.08769069555023*fI[1]*x**3)/dx**3+(7.513009550107064*fR[0]*x**3)/dx**3-(7.513009550107064*fL[0]*x**3)/dx**3-(7.300414442029338*fR[2]*x**2)/dx**2-(7.300414442029338*fL[2]*x**2)/dx**2+(52.99285610204038*fI[2]*x**2)/dx**2+(9.903210483517913*fR[1]*x**2)/dx**2-(9.903210483517913*fL[1]*x**2)/dx**2-(6.794854225464475*fR[0]*x**2)/dx**2-(6.794854225464475*fL[0]*x**2)/dx**2+(13.58970845092895*fI[0]*x**2)/dx**2-(0.9412717097844931*fR[2]*x)/dx+(0.9412717097844931*fL[2]*x)/dx+(1.234313190699334*fR[1]*x)/dx+(1.234313190699334*fL[1]*x)/dx+(5.721854946032574*fI[1]*x)/dx-(0.8286407592029846*fR[0]*x)/dx+(0.8286407592029846*fL[0]*x)/dx+0.1432907064763796*fR[2]+0.1432907064763796*fL[2]-1.670077889276424*fI[2]-0.1961505458088089*fR[1]+0.1961505458088089*fL[1]+0.1353446573364875*fR[0]+0.1353446573364875*fL[0]+0.4364174665135718*fI[0]

def plotSubCell(XX, q, cs):
    for i in range(1,q0.shape[0]-1):
        X = linspace(XX[i],XX[i+1],20)
        fi = calcSubCellFit_p1(q[i-1,:], q[i,:], q[i+1,:])
        plot(X, fi, cs)

    # plot first/last cells
    X = linspace(XX[0],XX[1],20)
    fi = calcSubCellFit_p1(q[-1,:], q[0,:], q[1,:])
    plot(X, fi, cs)

    X = linspace(XX[-2],XX[-1],20)
    fi = calcSubCellFit_p1(q[-2,:], q[-1,:], q[0,:])
    plot(X, fi, cs)

d0 = pg.GData("recon-advection_f_0.bp")
q0 = d0.getValues()
XX = d0.getGrid()

Xdo = linspace(XX[0][0], XX[0][-1], 32)
Xhr = linspace(XX[0][0], XX[0][-1], 100)

d1 = pg.GData("recon-advection_f_1.bp")
q1 = d1.getValues()

figure(1)
#plotSubCell(XX[0], q0, 'g-')
plotSubCell(XX[0], q1, 'k-')
plot(Xdo, sin(Xdo), 'ro')
plot(Xhr, sin(Xhr), 'r-', linewidth=0.5)
grid()
show()
